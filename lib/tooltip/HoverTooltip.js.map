{"version":3,"sources":["../../src/lib/tooltip/HoverTooltip.js"],"names":["HoverTooltip","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","pointer","helper","height","context","bgFill","bgOpacity","backgroundShapeSVG","tooltipSVG","bgheight","bgwidth","x","y","content","centerX","pointWidth","bgSize","bgShape","width","propTypes","chartId","oneOfType","number","string","yAccessor","func","isRequired","tooltipContent","origin","array","fontFamily","fontSize","contextTypes","margin","object","ratio","defaultProps","tooltipCanvas","fill","stroke","fontFill","opacity","backgroundShapeCanvas","PADDING","X","Y","tspans","startY","i","length","textY","push","label","value","fillStyle","strokeStyle","beginPath","rect","font","textAlign","fillText","measureText","originX","left","originY","top","save","setTransform","scale","translate","restore","calculateTooltipSize","canvas","document","createElement","getContext","str","map","reduce","res","size","sumSizes","String","sizes","Math","max","d","normalizeX","normalizeY","mouseXY","xAccessor","currentItem","xScale","chartConfig","xValue","round","findIndex","yValue","chartIndex","id","yScale","show","plotData","displayXAccessor","abs"],"mappings":"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","file":"HoverTooltip.js","sourcesContent":["\r\n\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport GenericComponent from \"../GenericComponent\";\r\nimport { sum } from \"d3-array\";\r\n\r\nimport { first, last, isNotDefined, isDefined, hexToRGBA } from \"../utils\";\r\n\r\nclass HoverTooltip extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.renderSVG = this.renderSVG.bind(this);\r\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\r\n\t}\r\n\tdrawOnCanvas(ctx, moreProps) {\r\n\t\tconst pointer = helper(this.props, moreProps, ctx);\r\n\t\tconst { height } = moreProps;\r\n\r\n\t\tif (isNotDefined(pointer)) return null;\r\n\t\tdrawOnCanvas(ctx, this.props, this.context, pointer, height, moreProps);\r\n\t}\r\n\trender() {\r\n\t\treturn <GenericComponent\r\n\t\t\tsvgDraw={this.renderSVG}\r\n\t\t\tcanvasDraw={this.drawOnCanvas}\r\n\t\t\tdrawOn={[\"mousemove\", \"pan\"/* , \"mouseleave\" */]}\r\n\t\t/>;\r\n\t}\r\n\trenderSVG(moreProps) {\r\n\t\tconst pointer = helper(this.props, moreProps);\r\n\r\n\t\tif (isNotDefined(pointer)) return null;\r\n\r\n\t\tconst { bgFill, bgOpacity, backgroundShapeSVG, tooltipSVG } = this.props;\r\n\t\tconst { bgheight, bgwidth } = this.props;\r\n\t\tconst { height } = moreProps;\r\n\r\n\t\tconst { x, y, content, centerX, pointWidth, bgSize } = pointer;\r\n\r\n\t\tconst bgShape = isDefined(bgwidth) && isDefined(bgheight)\r\n\t\t\t? { width: bgwidth, height: bgheight }\r\n\t\t\t: bgSize;\r\n\r\n\t\treturn (\r\n\t\t\t<g>\r\n\t\t\t\t<rect x={centerX - pointWidth / 2}\r\n\t\t\t\t\ty={0}\r\n\t\t\t\t\twidth={pointWidth}\r\n\t\t\t\t\theight={height}\r\n\t\t\t\t\tfill={bgFill}\r\n\t\t\t\t\topacity={bgOpacity} />\r\n\t\t\t\t<g className=\"react-stockcharts-tooltip-content\" transform={`translate(${x}, ${y})`}>\r\n\t\t\t\t\t{backgroundShapeSVG(this.props, bgShape)}\r\n\t\t\t\t\t{tooltipSVG(this.props, content)}\r\n\t\t\t\t</g>\r\n\t\t\t</g>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nHoverTooltip.propTypes = {\r\n\tchartId: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\r\n\tyAccessor: PropTypes.func,\r\n\ttooltipSVG: PropTypes.func,\r\n\tbackgroundShapeSVG: PropTypes.func,\r\n\tbgwidth: PropTypes.number,\r\n\tbgheight: PropTypes.number,\r\n\tbgFill: PropTypes.string.isRequired,\r\n\tbgOpacity: PropTypes.number.isRequired,\r\n\ttooltipContent: PropTypes.func.isRequired,\r\n\torigin: PropTypes.oneOfType([\r\n\t\tPropTypes.array,\r\n\t\tPropTypes.func\r\n\t]).isRequired,\r\n\tfontFamily: PropTypes.string,\r\n\tfontSize: PropTypes.number,\r\n};\r\n\r\nHoverTooltip.contextTypes = {\r\n\tmargin: PropTypes.object.isRequired,\r\n\tratio: PropTypes.number.isRequired,\r\n};\r\n\r\nHoverTooltip.defaultProps = {\r\n\t// bgwidth: 150,\r\n\t// bgheight: 50,\r\n\ttooltipSVG: tooltipSVG,\r\n\ttooltipCanvas: tooltipCanvas,\r\n\torigin: origin,\r\n\tfill: \"#D4E2FD\",\r\n\tbgFill: \"#D4E2FD\",\r\n\tbgOpacity: 0.5,\r\n\tstroke: \"#9B9BFF\",\r\n\tfontFill: \"#000000\",\r\n\topacity: 0.8,\r\n\tbackgroundShapeSVG: backgroundShapeSVG,\r\n\tbackgroundShapeCanvas: backgroundShapeCanvas,\r\n\tfontFamily: \"Helvetica Neue, Helvetica, Arial, sans-serif\",\r\n\tfontSize: 12,\r\n};\r\n\r\nconst PADDING = 5;\r\nconst X = 10;\r\nconst Y = 10;\r\n\r\n\r\n/* eslint-disable react/prop-types */\r\nfunction backgroundShapeSVG({ fill, stroke, opacity }, { height, width }) {\r\n\treturn <rect\r\n\t\theight={height}\r\n\t\twidth={width}\r\n\t\tfill={fill}\r\n\t\topacity={opacity}\r\n\t\tstroke={stroke} />;\r\n}\r\n\r\nfunction tooltipSVG({ fontFamily, fontSize, fontFill }, content) {\r\n\tconst tspans = [];\r\n\tconst startY = Y + fontSize * 0.9;\r\n\r\n\tfor (let i = 0; i < content.y.length; i++) {\r\n\t\tconst y = content.y[i];\r\n\t\tconst textY = startY + (fontSize * (i + 1));\r\n\r\n\t\ttspans.push(<tspan key={`L-${i}`} x={X} y={textY} fill={y.stroke}>{y.label}</tspan>);\r\n\t\ttspans.push(<tspan key={i}>: </tspan>);\r\n\t\ttspans.push(<tspan key={`V-${i}`}>{y.value}</tspan>);\r\n\t}\r\n\treturn <text fontFamily={fontFamily} fontSize={fontSize} fill={fontFill}>\r\n\t\t<tspan x={X} y={startY}>{content.x}</tspan>\r\n\t\t{tspans}\r\n\t</text>;\r\n}\r\n/* eslint-enable react/prop-types */\r\n\r\nfunction backgroundShapeCanvas(props, { width, height }, ctx) {\r\n\tconst { fill, stroke, opacity } = props;\r\n\r\n\tctx.fillStyle = hexToRGBA(fill, opacity);\r\n\tctx.strokeStyle = stroke;\r\n\tctx.beginPath();\r\n\tctx.rect(0, 0, width, height);\r\n\tctx.fill();\r\n\tctx.stroke();\r\n}\r\n\r\nfunction tooltipCanvas({ fontFamily, fontSize, fontFill }, content, ctx) {\r\n\tconst startY = Y + fontSize * 0.9;\r\n\tctx.font = `${fontSize}px ${fontFamily}`;\r\n\tctx.fillStyle = fontFill;\r\n\tctx.textAlign = \"left\";\r\n\tctx.fillText(content.x, X, startY);\r\n\r\n\tfor (let i = 0; i < content.y.length; i++) {\r\n\t\tconst y = content.y[i];\r\n\t\tconst textY = startY + (fontSize * (i + 1));\r\n\t\tctx.fillStyle = y.stroke || fontFill;\r\n\t\tctx.fillText(y.label, X, textY);\r\n\r\n\t\tctx.fillStyle = fontFill;\r\n\t\tctx.fillText(\": \" + y.value, X + ctx.measureText(y.label).width, textY);\r\n\t}\r\n}\r\n\r\nfunction drawOnCanvas(ctx, props, context, pointer, height) {\r\n\r\n\tconst { margin, ratio } = context;\r\n\tconst { bgFill, bgOpacity } = props;\r\n\tconst { backgroundShapeCanvas, tooltipCanvas } = props;\r\n\r\n\tconst originX = 0.5 * ratio + margin.left;\r\n\tconst originY = 0.5 * ratio + margin.top;\r\n\r\n\tctx.save();\r\n\r\n\tctx.setTransform(1, 0, 0, 1, 0, 0);\r\n\tctx.scale(ratio, ratio);\r\n\r\n\tctx.translate(originX, originY);\r\n\r\n\tconst { x, y, content, centerX, pointWidth, bgSize } = pointer;\r\n\r\n\tctx.fillStyle = hexToRGBA(bgFill, bgOpacity);\r\n\tctx.beginPath();\r\n\tctx.rect(centerX - pointWidth / 2, 0, pointWidth, height);\r\n\tctx.fill();\r\n\r\n\tctx.translate(x, y);\r\n\tbackgroundShapeCanvas(props, bgSize, ctx);\r\n\ttooltipCanvas(props, content, ctx);\r\n\r\n\tctx.restore();\r\n}\r\n\r\nfunction calculateTooltipSize({ fontFamily, fontSize, fontFill }, content, ctx) {\r\n\tif (isNotDefined(ctx)) {\r\n\t\tconst canvas = document.createElement(\"canvas\");\r\n\t\tctx = canvas.getContext(\"2d\");\r\n\t}\r\n\r\n\tctx.font = `${fontSize}px ${fontFamily}`;\r\n\tctx.fillStyle = fontFill;\r\n\tctx.textAlign = \"left\";\r\n\r\n\tconst measureText = str => ({\r\n\t\twidth: ctx.measureText(str).width,\r\n\t\theight: fontSize,\r\n\t});\r\n\r\n\tconst { width, height } = content.y\r\n\t\t.map(({ label, value }) => measureText(`${label}: ${value}`))\r\n\t\t// Sum all y and x sizes (begin with x label size)\r\n\t\t.reduce((res, size) => sumSizes(res, size), measureText(String(content.x)))\r\n\t;\r\n\r\n\treturn {\r\n\t\twidth: width + 2 * X,\r\n\t\theight: height + 2 * Y\r\n\t};\r\n}\r\n\r\nfunction sumSizes(...sizes) {\r\n\treturn {\r\n\t\twidth: Math.max(...sizes.map(size => size.width)),\r\n\t\theight: sum(sizes, d => d.height),\r\n\t};\r\n}\r\n\r\nfunction normalizeX(x, bgSize, pointWidth, width) {\r\n\t// return x - bgSize.width - pointWidth / 2 - PADDING * 2 < 0\r\n\treturn x < width / 2\r\n\t\t? x + pointWidth / 2 + PADDING\r\n\t\t: x - bgSize.width - pointWidth / 2 - PADDING;\r\n}\r\n\r\nfunction normalizeY(y, bgSize) {\r\n\treturn y - bgSize.height <= 0\r\n\t\t? y + PADDING\r\n\t\t: y - bgSize.height - PADDING;\r\n}\r\n\r\nfunction origin(props, moreProps, bgSize, pointWidth) {\r\n\tconst { chartId, yAccessor } = props;\r\n\tconst { mouseXY, xAccessor, currentItem, xScale, chartConfig, width } = moreProps;\r\n\tlet y = last(mouseXY);\r\n\r\n\tconst xValue = xAccessor(currentItem);\r\n\tlet x = Math.round(xScale(xValue));\r\n\r\n\tif (isDefined(chartId) && isDefined(yAccessor)\r\n\t\t\t&& isDefined(chartConfig) && isDefined(chartConfig.findIndex)) {\r\n\t\tconst yValue = yAccessor(currentItem);\r\n\t\tconst chartIndex = chartConfig.findIndex(x => x.id === chartId);\r\n\r\n\t\ty = Math.round(chartConfig[chartIndex].yScale(yValue));\r\n\t}\r\n\r\n\tx = normalizeX(x, bgSize, pointWidth, width);\r\n\ty = normalizeY(y, bgSize);\r\n\r\n\treturn [x, y];\r\n}\r\n\r\nfunction helper(props, moreProps, ctx) {\r\n\tconst { show, xScale, currentItem, plotData } = moreProps;\r\n\tconst { origin, tooltipContent } = props;\r\n\tconst { xAccessor, displayXAccessor } = moreProps;\r\n\r\n\tif (!show || isNotDefined(currentItem)) return;\r\n\r\n\tconst xValue = xAccessor(currentItem);\r\n\r\n\tif (!show || isNotDefined(xValue)) return;\r\n\r\n\tconst content = tooltipContent({ currentItem, xAccessor: displayXAccessor });\r\n\tconst centerX = xScale(xValue);\r\n\tconst pointWidth = Math.abs(xScale(xAccessor(last(plotData))) - xScale(xAccessor(first(plotData)))) / (plotData.length - 1);\r\n\r\n\tconst bgSize = calculateTooltipSize(props, content, ctx);\r\n\r\n\tconst [x, y] = origin(props, moreProps, bgSize, pointWidth);\r\n\r\n\treturn { x, y, content, centerX, pointWidth, bgSize };\r\n}\r\n\r\nexport default HoverTooltip;\r\n"]}