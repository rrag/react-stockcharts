{"version":3,"sources":["../../src/lib/series/CandlestickSeries.js"],"names":["CandlestickSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","className","wickClassName","candleClassName","xScale","yScale","chartConfig","plotData","xAccessor","candleData","getCandleData","getWicksSVG","getCandlesSVG","clip","propTypes","string","widthRatio","number","width","oneOfType","func","classNames","fill","stroke","wickStroke","yAccessor","bool","defaultProps","open","d","high","low","close","candleStrokeWidth","opacity","wicks","map","each","idx","wick","x","y1","y2","y3","y4","candles","y","height","wickNest","key","entries","forEach","outer","values","strokeStyle","fillStyle","fillRect","candleNest","strokeKey","strokeValues","lineWidth","inner","strokeRect","wickStrokeProp","fillProp","strokeProp","widthFunctor","trueOffset","offset","Math","round","floor","i","length","ohlc","max","abs","push","direction"],"mappings":"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","file":"CandlestickSeries.js","sourcesContent":["\r\n\r\nimport { nest } from \"d3-collection\";\r\n\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\n\r\nimport GenericChartComponent from \"../GenericChartComponent\";\r\nimport { getAxisCanvas } from \"../GenericComponent\";\r\n\r\nimport {\r\n\thexToRGBA, isDefined, functor, plotDataLengthBarWidth, head\r\n} from \"../utils\";\r\n\r\nclass CandlestickSeries extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.renderSVG = this.renderSVG.bind(this);\r\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\r\n\t}\r\n\tdrawOnCanvas(ctx, moreProps) {\r\n\t\tdrawOnCanvas(ctx, this.props, moreProps);\r\n\t}\r\n\trenderSVG(moreProps) {\r\n\t\tconst { className, wickClassName, candleClassName } = this.props;\r\n\t\tconst { xScale, chartConfig: { yScale }, plotData, xAccessor } = moreProps;\r\n\r\n\t\tconst candleData = getCandleData(this.props, xAccessor, xScale, yScale, plotData);\r\n\r\n\t\treturn <g className={className}>\r\n\t\t\t<g className={wickClassName} key=\"wicks\">\r\n\t\t\t\t{getWicksSVG(candleData)}\r\n\t\t\t</g>\r\n\t\t\t<g className={candleClassName} key=\"candles\">\r\n\t\t\t\t{getCandlesSVG(this.props, candleData)}\r\n\t\t\t</g>\r\n\t\t</g>;\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst { clip } = this.props;\r\n\t\treturn <GenericChartComponent\r\n\t\t\tclip={clip}\r\n\t\t\tsvgDraw={this.renderSVG}\r\n\t\t\tcanvasDraw={this.drawOnCanvas}\r\n\t\t\tcanvasToDraw={getAxisCanvas}\r\n\t\t\tdrawOn={[\"pan\"]}\r\n\t\t/>;\r\n\t}\r\n}\r\n\r\nCandlestickSeries.propTypes = {\r\n\tclassName: PropTypes.string,\r\n\twickClassName: PropTypes.string,\r\n\tcandleClassName: PropTypes.string,\r\n\twidthRatio: PropTypes.number,\r\n\twidth: PropTypes.oneOfType([\r\n\t\tPropTypes.number,\r\n\t\tPropTypes.func\r\n\t]),\r\n\tclassNames: PropTypes.oneOfType([\r\n\t\tPropTypes.func,\r\n\t\tPropTypes.string\r\n\t]),\r\n\tfill: PropTypes.oneOfType([\r\n\t\tPropTypes.func,\r\n\t\tPropTypes.string\r\n\t]),\r\n\tstroke: PropTypes.oneOfType([\r\n\t\tPropTypes.func,\r\n\t\tPropTypes.string\r\n\t]),\r\n\twickStroke: PropTypes.oneOfType([\r\n\t\tPropTypes.func,\r\n\t\tPropTypes.string\r\n\t]),\r\n\tyAccessor: PropTypes.func,\r\n\tclip: PropTypes.bool,\r\n};\r\n\r\nCandlestickSeries.defaultProps = {\r\n\tclassName: \"react-stockcharts-candlestick\",\r\n\twickClassName: \"react-stockcharts-candlestick-wick\",\r\n\tcandleClassName: \"react-stockcharts-candlestick-candle\",\r\n\tyAccessor: d => ({ open: d.open, high: d.high, low: d.low, close: d.close }),\r\n\tclassNames: d => d.close > d.open ? \"up\" : \"down\",\r\n\twidth: plotDataLengthBarWidth,\r\n\twickStroke: \"#000000\",\r\n\t// wickStroke: d => d.close > d.open ? \"#6BA583\" : \"#FF0000\",\r\n\tfill: d => d.close > d.open ? \"#6BA583\" : \"#FF0000\",\r\n\t// stroke: d => d.close > d.open ? \"#6BA583\" : \"#FF0000\",\r\n\tstroke: \"#000000\",\r\n\tcandleStrokeWidth: 0.5,\r\n\t// stroke: \"none\",\r\n\twidthRatio: 0.8,\r\n\topacity: 0.5,\r\n\tclip: true,\r\n};\r\n\r\nfunction getWicksSVG(candleData) {\r\n\r\n\tconst wicks = candleData\r\n\t\t.map((each, idx) => {\r\n\t\t\tconst d = each.wick;\r\n\t\t\treturn <path key={idx}\r\n\t\t\t\tclassName={each.className}\r\n\t\t\t\tstroke={d.stroke}\r\n\t\t\t\td={`M${d.x},${d.y1} L${d.x},${d.y2} M${d.x},${d.y3} L${d.x},${d.y4}`} />;\r\n\t\t});\r\n\r\n\treturn wicks;\r\n}\r\n\r\nfunction getCandlesSVG(props, candleData) {\r\n\r\n\t/* eslint-disable react/prop-types */\r\n\tconst { opacity, candleStrokeWidth } = props;\r\n\t/* eslint-enable react/prop-types */\r\n\r\n\tconst candles = candleData.map((d, idx) => {\r\n\t\tif (d.width <= 1)\r\n\t\t\treturn (\r\n\t\t\t\t<line className={d.className} key={idx}\r\n\t\t\t\t\tx1={d.x} y1={d.y} x2={d.x} y2={d.y + d.height}\r\n\t\t\t\t\tstroke={d.fill} />\r\n\t\t\t);\r\n\t\telse if (d.height === 0)\r\n\t\t\treturn (\r\n\t\t\t\t<line key={idx}\r\n\t\t\t\t\tx1={d.x} y1={d.y} x2={d.x + d.width} y2={d.y + d.height}\r\n\t\t\t\t\tstroke={d.fill} />\r\n\t\t\t);\r\n\t\treturn (\r\n\t\t\t<rect key={idx} className={d.className}\r\n\t\t\t\tfillOpacity={opacity}\r\n\t\t\t\tx={d.x} y={d.y} width={d.width} height={d.height}\r\n\t\t\t\tfill={d.fill} stroke={d.stroke} strokeWidth={candleStrokeWidth} />\r\n\t\t);\r\n\t});\r\n\treturn candles;\r\n}\r\n\r\nfunction drawOnCanvas(ctx, props, moreProps) {\r\n\tconst { opacity, candleStrokeWidth } = props;\r\n\tconst { xScale, chartConfig: { yScale }, plotData, xAccessor } = moreProps;\r\n\r\n\t// const wickData = getWickData(props, xAccessor, xScale, yScale, plotData);\r\n\tconst candleData = getCandleData(props, xAccessor, xScale, yScale, plotData);\r\n\r\n\tconst wickNest = nest()\r\n\t\t.key(d => d.wick.stroke)\r\n\t\t.entries(candleData);\r\n\r\n\twickNest.forEach(outer => {\r\n\t\tconst { key, values } = outer;\r\n\t\tctx.strokeStyle = key;\r\n\t\tctx.fillStyle = key;\r\n\t\tvalues.forEach(each => {\r\n\t\t\t/*\r\n\t\t\tctx.moveTo(d.x, d.y1);\r\n\t\t\tctx.lineTo(d.x, d.y2);\r\n\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.moveTo(d.x, d.y3);\r\n\t\t\tctx.lineTo(d.x, d.y4);\r\n\t\t\tctx.stroke(); */\r\n\t\t\tconst d = each.wick;\r\n\r\n\t\t\tctx.fillRect(d.x - 0.5, d.y1, 1, d.y2 - d.y1);\r\n\t\t\tctx.fillRect(d.x - 0.5, d.y3, 1, d.y4 - d.y3);\r\n\t\t});\r\n\t});\r\n\r\n\t// const candleData = getCandleData(props, xAccessor, xScale, yScale, plotData);\r\n\r\n\tconst candleNest = nest()\r\n\t\t.key(d => d.stroke)\r\n\t\t.key(d => d.fill)\r\n\t\t.entries(candleData);\r\n\r\n\r\n\tcandleNest.forEach(outer => {\r\n\t\tconst { key: strokeKey, values: strokeValues } = outer;\r\n\t\tif (strokeKey !== \"none\") {\r\n\t\t\tctx.strokeStyle = strokeKey;\r\n\t\t\tctx.lineWidth = candleStrokeWidth;\r\n\t\t}\r\n\t\tstrokeValues.forEach(inner => {\r\n\t\t\tconst { key, values } = inner;\r\n\t\t\tconst fillStyle = head(values).width <= 1\r\n\t\t\t\t? key\r\n\t\t\t\t: hexToRGBA(key, opacity);\r\n\t\t\tctx.fillStyle = fillStyle;\r\n\r\n\t\t\tvalues.forEach(d => {\r\n\t\t\t\tif (d.width <= 1) {\r\n\t\t\t\t\t// <line className={d.className} key={idx} x1={d.x} y1={d.y} x2={d.x} y2={d.y + d.height}/>\r\n\t\t\t\t\t/*\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.moveTo(d.x, d.y);\r\n\t\t\t\t\tctx.lineTo(d.x, d.y + d.height);\r\n\t\t\t\t\tctx.stroke();\r\n\t\t\t\t\t*/\r\n\t\t\t\t\tctx.fillRect(d.x - 0.5, d.y, 1, d.height);\r\n\t\t\t\t} else if (d.height === 0) {\r\n\t\t\t\t\t// <line key={idx} x1={d.x} y1={d.y} x2={d.x + d.width} y2={d.y + d.height} />\r\n\t\t\t\t\t/*\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.moveTo(d.x, d.y);\r\n\t\t\t\t\tctx.lineTo(d.x + d.width, d.y + d.height);\r\n\t\t\t\t\tctx.stroke();\r\n\t\t\t\t\t*/\r\n\t\t\t\t\tctx.fillRect(d.x, d.y - 0.5, d.width, 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t/*\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.rect(d.x, d.y, d.width, d.height);\r\n\t\t\t\t\tctx.closePath();\r\n\t\t\t\t\tctx.fill();\r\n\t\t\t\t\tif (strokeKey !== \"none\") ctx.stroke();\r\n\t\t\t\t\t*/\r\n\t\t\t\t\tctx.fillRect(d.x, d.y, d.width, d.height);\r\n\t\t\t\t\tif (strokeKey !== \"none\") ctx.strokeRect(d.x, d.y, d.width, d.height);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t});\r\n}\r\n/*\r\nfunction getWickData(props, xAccessor, xScale, yScale, plotData) {\r\n\r\n\tconst { classNames: classNameProp, wickStroke: wickStrokeProp, yAccessor } = props;\r\n\tconst wickStroke = functor(wickStrokeProp);\r\n\tconst className = functor(classNameProp);\r\n\tconst wickData = plotData\r\n\t\t\t.filter(d => isDefined(yAccessor(d).close))\r\n\t\t\t.map(d => {\r\n\t\t\t\t// console.log(yAccessor);\r\n\t\t\t\tconst ohlc = yAccessor(d);\r\n\r\n\t\t\t\tconst x = Math.round(xScale(xAccessor(d))),\r\n\t\t\t\t\ty1 = yScale(ohlc.high),\r\n\t\t\t\t\ty2 = yScale(Math.max(ohlc.open, ohlc.close)),\r\n\t\t\t\t\ty3 = yScale(Math.min(ohlc.open, ohlc.close)),\r\n\t\t\t\t\ty4 = yScale(ohlc.low);\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tx,\r\n\t\t\t\t\ty1,\r\n\t\t\t\t\ty2,\r\n\t\t\t\t\ty3,\r\n\t\t\t\t\ty4,\r\n\t\t\t\t\tclassName: className(ohlc),\r\n\t\t\t\t\tdirection: (ohlc.close - ohlc.open),\r\n\t\t\t\t\tstroke: wickStroke(ohlc),\r\n\t\t\t\t};\r\n\t\t\t});\r\n\treturn wickData;\r\n}\r\n*/\r\n\r\nfunction getCandleData(props, xAccessor, xScale, yScale, plotData) {\r\n\r\n\tconst { wickStroke: wickStrokeProp } = props;\r\n\tconst wickStroke = functor(wickStrokeProp);\r\n\r\n\tconst { classNames, fill: fillProp, stroke: strokeProp, yAccessor } = props;\r\n\tconst className = functor(classNames);\r\n\r\n\tconst fill = functor(fillProp);\r\n\tconst stroke = functor(strokeProp);\r\n\r\n\tconst widthFunctor = functor(props.width);\r\n\tconst width = widthFunctor(props, {\r\n\t\txScale,\r\n\t\txAccessor,\r\n\t\tplotData\r\n\t});\r\n\r\n\t/*\r\n\tconst candleWidth = Math.round(width);\r\n\tconst offset = Math.round(candleWidth === 1 ? 0 : 0.5 * width);\r\n\t*/\r\n\tconst trueOffset = 0.5 * width;\r\n\tconst offset = trueOffset > 0.7\r\n\t\t? Math.round(trueOffset)\r\n\t\t: Math.floor(trueOffset);\r\n\r\n\t// eslint-disable-next-line prefer-const\r\n\tlet candles = [];\r\n\r\n\tfor (let i = 0; i < plotData.length; i++) {\r\n\t\tconst d = plotData[i];\r\n\t\tif (isDefined(yAccessor(d).close)) {\r\n\t\t\tconst x = Math.round(xScale(xAccessor(d)));\r\n\t\t\t// const x = Math.round(xScale(xAccessor(d)) - offset);\r\n\r\n\t\t\tconst ohlc = yAccessor(d);\r\n\t\t\tconst y = Math.round(yScale(Math.max(ohlc.open, ohlc.close)));\r\n\t\t\tconst height = Math.round(Math.abs(yScale(ohlc.open) - yScale(ohlc.close)));\r\n\r\n\t\t\tcandles.push({\r\n\t\t\t\t// type: \"line\"\r\n\t\t\t\tx: x - offset,\r\n\t\t\t\ty: y,\r\n\t\t\t\twick: {\r\n\t\t\t\t\tstroke: wickStroke(ohlc),\r\n\t\t\t\t\tx: x,\r\n\t\t\t\t\ty1: Math.round(yScale(ohlc.high)),\r\n\t\t\t\t\ty2: y,\r\n\t\t\t\t\ty3: y + height, // Math.round(yScale(Math.min(ohlc.open, ohlc.close))),\r\n\t\t\t\t\ty4: Math.round(yScale(ohlc.low)),\r\n\t\t\t\t},\r\n\t\t\t\theight: height,\r\n\t\t\t\twidth: offset * 2,\r\n\t\t\t\tclassName: className(ohlc),\r\n\t\t\t\tfill: fill(ohlc),\r\n\t\t\t\tstroke: stroke(ohlc),\r\n\t\t\t\tdirection: (ohlc.close - ohlc.open),\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\treturn candles;\r\n}\r\n\r\nexport default CandlestickSeries;\r\n"]}