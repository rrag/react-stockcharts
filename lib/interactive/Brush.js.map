{"version":3,"sources":["../../src/lib/interactive/Brush.js"],"names":["Brush","props","context","handleZoomStart","bind","handleDrawSquare","handleZoomComplete","drawOnCanvas","renderSVG","saveNode","terminate","state","rect","zoomHappening","setState","x1y1","start","end","node","ctx","x","y","height","width","stroke","fill","strokeDashArray","strokeOpacity","fillOpacity","dashArray","split","map","d","strokeStyle","fillStyle","setLineDash","beginPath","fillRect","strokeRect","moreProps","mouseXY","mouseY","currentItem","yScale","chartConfig","xAccessor","xScale","selected","item","xValue","yValue","invert","x2","y2","x1","y1","Math","min","abs","onBrush","enabled","propTypes","bool","isRequired","onStart","func","type","oneOf","string","number","interactiveState","object","defaultProps"],"mappings":"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","file":"Brush.js","sourcesContent":["\r\n\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\n\r\nimport {\r\n\tisDefined,\r\n\tnoop,\r\n\tgetStrokeDasharray,\r\n\thexToRGBA,\r\n} from \"../utils\";\r\nimport GenericChartComponent from \"../GenericChartComponent\";\r\nimport { getMouseCanvas } from \"../GenericComponent\";\r\n\r\nclass Brush extends Component {\r\n\tconstructor(props, context) {\r\n\t\tsuper(props, context);\r\n\t\tthis.handleZoomStart = this.handleZoomStart.bind(this);\r\n\t\tthis.handleDrawSquare = this.handleDrawSquare.bind(this);\r\n\t\tthis.handleZoomComplete = this.handleZoomComplete.bind(this);\r\n\r\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\r\n\t\tthis.renderSVG = this.renderSVG.bind(this);\r\n\t\tthis.saveNode = this.saveNode.bind(this);\r\n\t\tthis.terminate = this.terminate.bind(this);\r\n\t\tthis.state = {\r\n\t\t\trect: null,\r\n\t\t};\r\n\t}\r\n\tterminate() {\r\n\t\tthis.zoomHappening = false;\r\n\t\tthis.setState({\r\n\t\t\tx1y1: null,\r\n\t\t\tstart: null,\r\n\t\t\tend: null,\r\n\t\t\trect: null,\r\n\t\t});\r\n\t}\r\n\tsaveNode(node) {\r\n\t\tthis.node = node;\r\n\t}\r\n\tdrawOnCanvas(ctx) {\r\n\t\tconst { rect } = this.state;\r\n\t\tif (isDefined(rect)) {\r\n\t\t\tconst { x, y, height, width } = rect;\r\n\t\t\tconst { stroke, fill, strokeDashArray } = this.props;\r\n\t\t\tconst { strokeOpacity, fillOpacity } = this.props;\r\n\r\n\t\t\tconst dashArray = getStrokeDasharray(strokeDashArray)\r\n\t\t\t\t.split(\",\")\r\n\t\t\t\t.map(d => +d);\r\n\r\n\t\t\tctx.strokeStyle = hexToRGBA(stroke, strokeOpacity);\r\n\t\t\tctx.fillStyle = hexToRGBA(fill, fillOpacity);\r\n\t\t\tctx.setLineDash(dashArray);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.fillRect(x, y, width, height);\r\n\t\t\tctx.strokeRect(x, y, width, height);\r\n\t\t}\r\n\t}\r\n\trenderSVG() {\r\n\t\tconst { rect } = this.state;\r\n\t\tif (isDefined(rect)) {\r\n\t\t\tconst { x, y, height, width } = rect;\r\n\t\t\tconst { stroke, strokeDashArray } = this.props;\r\n\t\t\tconst { strokeOpacity, fillOpacity } = this.props;\r\n\r\n\t\t\tconst dashArray = getStrokeDasharray(strokeDashArray)\r\n\t\t\t\t.split(\",\")\r\n\t\t\t\t.map(d => +d);\r\n\r\n\t\t\treturn (\r\n\t\t\t\t<rect strokeDasharray={dashArray}\r\n\t\t\t\t\tstroke={stroke}\r\n\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\tstrokeOpacity={strokeOpacity}\r\n\t\t\t\t\tfillOpacity={fillOpacity}\r\n\t\t\t\t\tx={x}\r\n\t\t\t\t\ty={y}\r\n\t\t\t\t\twidth={width}\r\n\t\t\t\t\theight={height}\r\n\t\t\t\t/>\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\thandleZoomStart(moreProps) {\r\n\t\tthis.zoomHappening = false;\r\n\t\tconst {\r\n\t\t\tmouseXY: [, mouseY],\r\n\t\t\tcurrentItem,\r\n\t\t\tchartConfig: { yScale },\r\n\t\t\txAccessor,\r\n\t\t\txScale,\r\n\t\t} = moreProps;\r\n\r\n\t\tconst x1y1 = [\r\n\t\t\txScale(xAccessor(currentItem)),\r\n\t\t\tmouseY\r\n\t\t];\r\n\r\n\t\tthis.setState({\r\n\t\t\tselected: true,\r\n\t\t\tx1y1,\r\n\t\t\tstart: {\r\n\t\t\t\titem: currentItem,\r\n\t\t\t\txValue: xAccessor(currentItem),\r\n\t\t\t\tyValue: yScale.invert(mouseY),\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\thandleDrawSquare(moreProps) {\r\n\t\tif (this.state.x1y1 == null) return;\r\n\r\n\t\tthis.zoomHappening = true;\r\n\r\n\t\tconst {\r\n\t\t\tmouseXY: [, mouseY],\r\n\t\t\tcurrentItem,\r\n\t\t\tchartConfig: { yScale },\r\n\t\t\txAccessor,\r\n\t\t\txScale,\r\n\t\t} = moreProps;\r\n\r\n\t\tconst [x2, y2] = [\r\n\t\t\txScale(xAccessor(currentItem)),\r\n\t\t\tmouseY\r\n\t\t];\r\n\r\n\t\tconst { x1y1: [x1, y1] } = this.state;\r\n\r\n\t\tconst x = Math.min(x1, x2);\r\n\t\tconst y = Math.min(y1, y2);\r\n\t\tconst height = Math.abs(y2 - y1);\r\n\t\tconst width = Math.abs(x2 - x1);\r\n\r\n\t\tthis.setState({\r\n\t\t\tselected: true,\r\n\t\t\tend: {\r\n\t\t\t\titem: currentItem,\r\n\t\t\t\txValue: xAccessor(currentItem),\r\n\t\t\t\tyValue: yScale.invert(mouseY),\r\n\t\t\t},\r\n\t\t\trect: {\r\n\t\t\t\tx, y, height, width\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\thandleZoomComplete(moreProps) {\r\n\t\tif (this.zoomHappening) {\r\n\t\t\tconst { onBrush } = this.props;\r\n\t\t\tconst { start, end } = this.state;\r\n\t\t\tonBrush({ start, end }, moreProps);\r\n\t\t}\r\n\t\tthis.setState({\r\n\t\t\tselected: false,\r\n\t\t\trect: null,\r\n\t\t});\r\n\t}\r\n\trender() {\r\n\t\tconst { enabled } = this.props;\r\n\t\tif (!enabled) return null;\r\n\r\n\t\treturn (\r\n\t\t\t<GenericChartComponent\r\n\t\t\t\tref={this.saveNode}\r\n\t\t\t\tdisablePan={enabled}\r\n\r\n\t\t\t\tsvgDraw={this.renderSVG}\r\n\t\t\t\tcanvasToDraw={getMouseCanvas}\r\n\t\t\t\tcanvasDraw={this.drawOnCanvas}\r\n\r\n\t\t\t\tonMouseDown={this.handleZoomStart}\r\n\t\t\t\tonMouseMove={this.handleDrawSquare}\r\n\t\t\t\tonClick={this.handleZoomComplete}\r\n\r\n\t\t\t\tdrawOn={[\"mousemove\", \"pan\", \"drag\"]}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nBrush.propTypes = {\r\n\tenabled: PropTypes.bool.isRequired,\r\n\tonStart: PropTypes.func.isRequired,\r\n\tonBrush: PropTypes.func.isRequired,\r\n\r\n\ttype: PropTypes.oneOf([\"1D\", \"2D\"]),\r\n\tstroke: PropTypes.string,\r\n\tfill: PropTypes.string,\r\n\tstrokeOpacity: PropTypes.number,\r\n\tfillOpacity: PropTypes.number,\r\n\tinteractiveState: PropTypes.object,\r\n\tstrokeDashArray: PropTypes.string,\r\n};\r\n\r\nBrush.defaultProps = {\r\n\ttype: \"2D\",\r\n\tstroke: \"#000000\",\r\n\tfillOpacity: 0.3,\r\n\tstrokeOpacity: 1,\r\n\tfill: \"#3h3h3h\",\r\n\tonBrush: noop,\r\n\tonStart: noop,\r\n\tstrokeDashArray: \"ShortDash\",\r\n};\r\n\r\nexport default Brush;\r\n"]}