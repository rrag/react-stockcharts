{"version":3,"sources":["../../../src/lib/interactive/components/InteractiveText.js"],"names":["InteractiveText","props","calculateTextWidth","renderSVG","bind","drawOnCanvas","isHover","moreProps","onHover","textWidth","helper","rect","mouseXY","x","y","width","height","nextProps","text","fontStyle","fontWeight","fontSize","fontFamily","ctx","bgFill","bgOpacity","bgStrokeWidth","bgStroke","textFill","font","measureText","selected","fillStyle","beginPath","fillRect","strokeStyle","lineWidth","strokeRect","textBaseline","textAlign","fillText","Error","interactiveCursorClass","onUnHover","onDragStart","onDrag","onDragComplete","position","xScale","yScale","chartConfig","xValue","yValue","propTypes","string","isRequired","number","oneOfType","func","defaultClassName","tolerance","bool","defaultProps","type"],"mappings":"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","file":"InteractiveText.js","sourcesContent":["import React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\n\r\nimport GenericChartComponent from \"../../GenericChartComponent\";\r\nimport { getMouseCanvas } from \"../../GenericComponent\";\r\n\r\nimport { isDefined, noop, hexToRGBA } from \"../../utils\";\r\n\r\nclass InteractiveText extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.calculateTextWidth = true;\r\n\r\n\t\tthis.renderSVG = this.renderSVG.bind(this);\r\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\r\n\t\tthis.isHover = this.isHover.bind(this);\r\n\t}\r\n\tisHover(moreProps) {\r\n\t\tconst { onHover } = this.props;\r\n\r\n\t\tif (\r\n\t\t\tisDefined(onHover)\r\n\t\t\t&& isDefined(this.textWidth)\r\n\t\t\t&& !this.calculateTextWidth\r\n\t\t) {\r\n\t\t\tconst { rect } = helper(this.props, moreProps, this.textWidth);\r\n\t\t\tconst { mouseXY: [x, y] } = moreProps;\r\n\r\n\t\t\tif (\r\n\t\t\t\tx >= rect.x\r\n\t\t\t\t&& y >= rect.y\r\n\t\t\t\t&& x <= rect.x + rect.width\r\n\t\t\t\t&& y <= rect.y + rect.height\r\n\t\t\t) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tcomponentWillReceiveProps(nextProps) {\r\n\t\tthis.calculateTextWidth = (\r\n\t\t\tnextProps.text !== this.props.text\r\n\t\t\t|| nextProps.fontStyle !== this.props.fontStyle\r\n\t\t\t|| nextProps.fontWeight !== this.props.fontWeight\r\n\t\t\t|| nextProps.fontSize !== this.props.fontSize\r\n\t\t\t|| nextProps.fontFamily !== this.props.fontFamily\r\n\t\t);\r\n\t}\r\n\tdrawOnCanvas(ctx, moreProps) {\r\n\t\tconst {\r\n\t\t\tbgFill,\r\n\t\t\tbgOpacity,\r\n\t\t\tbgStrokeWidth,\r\n\t\t\tbgStroke,\r\n\t\t\ttextFill,\r\n\t\t\tfontFamily,\r\n\t\t\tfontSize,\r\n\t\t\tfontStyle,\r\n\t\t\tfontWeight,\r\n\t\t\ttext,\r\n\t\t} = this.props;\r\n\r\n\t\tif (this.calculateTextWidth) {\r\n\t\t\tctx.font = `${fontStyle} ${fontWeight} ${fontSize}px ${fontFamily}`;\r\n\t\t\tconst { width } = ctx.measureText(text);\r\n\t\t\tthis.textWidth = width;\r\n\t\t\tthis.calculateTextWidth = false;\r\n\t\t}\r\n\r\n\t\tconst { selected } = this.props;\r\n\r\n\t\tconst { x, y, rect } = helper(this.props, moreProps, this.textWidth);\r\n\r\n\t\tctx.fillStyle = hexToRGBA(bgFill, bgOpacity);\r\n\r\n\t\tctx.beginPath();\r\n\t\tctx.fillRect(rect.x, rect.y, rect.width, rect.height);\r\n\r\n\t\tif (selected) {\r\n\t\t\tctx.strokeStyle = bgStroke;\r\n\t\t\tctx.lineWidth = bgStrokeWidth;\r\n\t\t\tctx.strokeRect(rect.x, rect.y, rect.width, rect.height);\r\n\t\t}\r\n\r\n\t\tctx.fillStyle = textFill;\r\n\t\tctx.textBaseline = \"middle\";\r\n\t\tctx.textAlign = \"center\";\r\n\t\tctx.font = `${fontStyle} ${fontWeight} ${fontSize}px ${fontFamily}`;\r\n\r\n\t\tctx.beginPath();\r\n\t\tctx.fillText(text, x, y);\r\n\t}\r\n\trenderSVG() {\r\n\t\tthrow new Error(\"svg not implemented\");\r\n\t}\r\n\trender() {\r\n\t\tconst { selected, interactiveCursorClass } = this.props;\r\n\t\tconst { onHover, onUnHover } = this.props;\r\n\t\tconst { onDragStart, onDrag, onDragComplete } = this.props;\r\n\r\n\t\treturn <GenericChartComponent\r\n\t\t\tisHover={this.isHover}\r\n\r\n\t\t\tsvgDraw={this.renderSVG}\r\n\t\t\tcanvasToDraw={getMouseCanvas}\r\n\t\t\tcanvasDraw={this.drawOnCanvas}\r\n\r\n\t\t\tinteractiveCursorClass={interactiveCursorClass}\r\n\t\t\tselected={selected}\r\n\r\n\t\t\tonDragStart={onDragStart}\r\n\t\t\tonDrag={onDrag}\r\n\t\t\tonDragComplete={onDragComplete}\r\n\t\t\tonHover={onHover}\r\n\t\t\tonUnHover={onUnHover}\r\n\r\n\t\t\tdrawOn={[\"mousemove\", \"mouseleave\", \"pan\", \"drag\"]}\r\n\t\t/>;\r\n\t}\r\n}\r\n\r\nfunction helper(props, moreProps, textWidth) {\r\n\tconst { position, fontSize } = props;\r\n\r\n\tconst { xScale, chartConfig: { yScale } } = moreProps;\r\n\r\n\tconst [xValue, yValue] = position;\r\n\tconst x = xScale(xValue);\r\n\tconst y = yScale(yValue);\r\n\r\n\tconst rect = {\r\n\t\tx: x - textWidth / 2 - fontSize,\r\n\t\ty: y - fontSize,\r\n\t\twidth: textWidth + fontSize * 2,\r\n\t\theight: fontSize * 2,\r\n\t};\r\n\r\n\treturn {\r\n\t\tx, y, rect\r\n\t};\r\n}\r\n\r\nInteractiveText.propTypes = {\r\n\tbgFill: PropTypes.string.isRequired,\r\n\tbgOpacity: PropTypes.number.isRequired,\r\n\tbgStrokeWidth: PropTypes.number.isRequired,\r\n\tbgStroke: PropTypes.string.isRequired,\r\n\r\n\ttextFill: PropTypes.string.isRequired,\r\n\tfontFamily: PropTypes.string.isRequired,\r\n\tfontSize: PropTypes.number.isRequired,\r\n\tfontWeight: PropTypes.oneOfType([\r\n\t\tPropTypes.number,\r\n\t\tPropTypes.string,\r\n\t]).isRequired,\r\n\tfontStyle: PropTypes.string.isRequired,\r\n\r\n\ttext: PropTypes.string.isRequired,\r\n\r\n\tonDragStart: PropTypes.func.isRequired,\r\n\tonDrag: PropTypes.func.isRequired,\r\n\tonDragComplete: PropTypes.func.isRequired,\r\n\tonHover: PropTypes.func,\r\n\tonUnHover: PropTypes.func,\r\n\r\n\tdefaultClassName: PropTypes.string,\r\n\tinteractiveCursorClass: PropTypes.string,\r\n\r\n\ttolerance: PropTypes.number.isRequired,\r\n\tselected: PropTypes.bool.isRequired,\r\n};\r\n\r\nInteractiveText.defaultProps = {\r\n\tonDragStart: noop,\r\n\tonDrag: noop,\r\n\tonDragComplete: noop,\r\n\r\n\ttype: \"SD\", // standard dev\r\n\tfontWeight: \"normal\", // standard dev\r\n\r\n\ttolerance: 4,\r\n\tselected: false,\r\n};\r\n\r\nexport default InteractiveText;"]}