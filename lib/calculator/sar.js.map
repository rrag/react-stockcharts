{"version":3,"sources":["../../src/lib/calculator/sar.js"],"names":["options","calculator","data","accelerationFactor","maxAccelerationFactor","algorithm","windowSize","undefinedValue","high","low","risingSar","risingEp","fallingSar","fallingEp","af","accumulator","prev","now","calc","use","current","Math","min","max","date","sar","calculatedData","map","d","undefinedLength","x","arguments","length"],"mappings":"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","file":"sar.js","sourcesContent":["\r\n\r\nimport { mappedSlidingWindow, isNotDefined, isDefined } from \"../utils\";\r\nimport { SAR as defaultOptions } from \"./defaultOptionsForComputation\";\r\n\r\nfunction calc(prev, now) {\r\n\tconst risingSar = prev.risingSar\r\n\t\t+ prev.af * (prev.risingEp - prev.risingSar);\r\n\r\n\tconst fallingSar = prev.fallingSar\r\n\t\t- prev.af * (prev.fallingSar - prev.fallingEp);\r\n\r\n\tconst risingEp = Math.max(prev.risingEp, now.high);\r\n\tconst fallingEp = Math.min(prev.fallingEp, now.low);\r\n\r\n\treturn {\r\n\t\trisingSar,\r\n\t\tfallingSar,\r\n\t\trisingEp,\r\n\t\tfallingEp,\r\n\t};\r\n}\r\n\r\nexport default function() {\r\n\r\n\tlet options = defaultOptions;\r\n\r\n\tfunction calculator(data) {\r\n\t\tconst { accelerationFactor, maxAccelerationFactor } = options;\r\n\r\n\t\tconst algorithm = mappedSlidingWindow()\r\n\t\t\t.windowSize(2)\r\n\t\t\t.undefinedValue(({ high, low }) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\trisingSar: low,\r\n\t\t\t\t\trisingEp: high,\r\n\t\t\t\t\tfallingSar: high,\r\n\t\t\t\t\tfallingEp: low,\r\n\t\t\t\t\taf: accelerationFactor,\r\n\t\t\t\t};\r\n\t\t\t})\r\n\t\t\t.accumulator(([prev, now]) => {\r\n\r\n\t\t\t\tconst {\r\n\t\t\t\t\trisingSar,\r\n\t\t\t\t\tfallingSar,\r\n\t\t\t\t\trisingEp,\r\n\t\t\t\t\tfallingEp,\r\n\t\t\t\t} = calc(prev, now);\r\n\r\n\t\t\t\tif (isNotDefined(prev.use)\r\n\t\t\t\t\t\t&& risingSar > now.low\r\n\t\t\t\t\t\t&& fallingSar < now.high) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\trisingSar,\r\n\t\t\t\t\t\tfallingSar,\r\n\t\t\t\t\t\trisingEp,\r\n\t\t\t\t\t\tfallingEp,\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst use = isDefined(prev.use)\r\n\t\t\t\t\t? prev.use === \"rising\"\r\n\t\t\t\t\t\t? risingSar > now.low ? \"falling\" : \"rising\"\r\n\t\t\t\t\t\t: fallingSar < now.high ? \"rising\" : \"falling\"\r\n\t\t\t\t\t: risingSar > now.low\r\n\t\t\t\t\t\t? \"falling\"\r\n\t\t\t\t\t\t: \"rising\";\r\n\r\n\t\t\t\tconst current = prev.use === use\r\n\t\t\t\t\t? {\r\n\t\t\t\t\t\taf: Math.min(maxAccelerationFactor, prev.af + accelerationFactor),\r\n\t\t\t\t\t\tfallingEp,\r\n\t\t\t\t\t\trisingEp,\r\n\t\t\t\t\t\tfallingSar,\r\n\t\t\t\t\t\trisingSar,\r\n\t\t\t\t\t}\r\n\t\t\t\t\t: {\r\n\t\t\t\t\t\taf: accelerationFactor,\r\n\t\t\t\t\t\tfallingEp: now.low,\r\n\t\t\t\t\t\trisingEp: now.high,\r\n\t\t\t\t\t\tfallingSar: Math.max(prev.risingEp, now.high),\r\n\t\t\t\t\t\trisingSar: Math.min(prev.fallingEp, now.low),\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\tconst { date, high, low } = now;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdate,\r\n\t\t\t\t\thigh,\r\n\t\t\t\t\tlow,\r\n\t\t\t\t\t...current,\r\n\t\t\t\t\tuse,\r\n\t\t\t\t\tsar: use === \"falling\" ? current.fallingSar : current.risingSar,\r\n\t\t\t\t};\r\n\t\t\t});\r\n\r\n\t\tconst calculatedData = algorithm(data).map(d => d.sar);\r\n\t\t// console.log(calculatedData);\r\n\r\n\t\treturn calculatedData;\r\n\t}\r\n\tcalculator.undefinedLength = function() {\r\n\t\treturn 1;\r\n\t};\r\n\tcalculator.options = function(x) {\r\n\t\tif (!arguments.length) {\r\n\t\t\treturn options;\r\n\t\t}\r\n\t\toptions = { ...defaultOptions, ...x };\r\n\t\treturn calculator;\r\n\t};\r\n\r\n\treturn calculator;\r\n}\r\n"]}